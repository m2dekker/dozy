<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Cold Room</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #999;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            -webkit-tap-highlight-color: transparent;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #story {
            min-height: 100px;
            color: #ccc;
            font-size: 18px;
            margin-bottom: 20px;
        }

        #temperature {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .section {
            border-top: 1px solid #333;
            padding-top: 20px;
        }

        .section-title {
            color: #fff;
            font-size: 20px;
            margin-bottom: 15px;
            text-transform: lowercase;
        }

        button {
            background-color: #222;
            color: #999;
            border: 1px solid #666;
            padding: 15px 25px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            min-width: 150px;
            transition: all 0.2s;
            text-transform: lowercase;
        }

        button:hover:not(:disabled) {
            background-color: #333;
            color: #fff;
            border-color: #999;
        }

        button:active:not(:disabled) {
            background-color: #444;
        }

        button:disabled {
            color: #444;
            border-color: #333;
            cursor: not-allowed;
        }

        .resource {
            color: #888;
            margin: 8px 0;
            font-size: 15px;
        }

        .resource-value {
            color: #ccc;
            float: right;
        }

        .building {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .building-name {
            color: #aaa;
            flex: 1;
            min-width: 150px;
        }

        .building-count {
            color: #666;
            margin: 0 10px;
        }

        .building-controls {
            display: flex;
            gap: 5px;
        }

        .building-controls button {
            min-width: 80px;
            padding: 10px 15px;
        }

        .cost {
            font-size: 13px;
            color: #666;
            margin-left: 5px;
        }

        #events {
            color: #aaa;
            font-style: italic;
            min-height: 30px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .hidden {
            display: none !important;
        }

        #reset-container {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #222;
            text-align: center;
        }

        #reset-container button {
            min-width: 100px;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            body {
                padding: 15px;
                font-size: 15px;
            }

            button {
                padding: 12px 20px;
                font-size: 15px;
            }

            .section-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="story">the room is cold</div>
        <div id="temperature"></div>
        <div id="events"></div>

        <div id="fire-section">
            <button id="stoke-fire" onclick="game.stokeTheFire()">light fire</button>
        </div>

        <div id="actions-section" class="section hidden">
            <div class="section-title">actions</div>
            <button id="gather-wood" onclick="game.gatherWood()">gather wood</button>
        </div>

        <div id="resources-section" class="section hidden">
            <div class="section-title">resources</div>
            <div id="resources"></div>
        </div>

        <div id="buildings-section" class="section hidden">
            <div class="section-title">buildings</div>
            <div id="buildings"></div>
        </div>

        <div id="reset-container">
            <button onclick="game.resetGame()">restart</button>
        </div>
    </div>

    <script>
        const game = {
            state: {
                fireStoked: false,
                temperature: 0,
                wood: 0,
                fur: 0,
                meat: 0,
                buildings: {
                    trap: 0,
                    cart: 0,
                    hut: 0
                },
                strangerArrived: false,
                gathererUnlocked: false,
                actionCooldowns: {
                    wood: 0
                }
            },

            init() {
                this.loadGame();
                this.updateUI();
                this.startGameLoop();
            },

            startGameLoop() {
                setInterval(() => {
                    this.tick();
                }, 1000);

                // Cooldown updates
                setInterval(() => {
                    this.updateCooldowns();
                }, 100);
            },

            tick() {
                // Temperature drops slowly
                if (this.state.fireStoked && this.state.temperature > 0) {
                    this.state.temperature -= 1;
                    if (this.state.temperature <= 0) {
                        this.state.temperature = 0;
                        this.showEvent("the fire has died");
                    }
                }

                // Traps produce resources
                if (this.state.buildings.trap > 0 && Math.random() < 0.1) {
                    const furGained = this.state.buildings.trap;
                    this.state.fur += furGained;
                    if (Math.random() < 0.5) {
                        const meatGained = Math.floor(this.state.buildings.trap / 2) || 1;
                        this.state.meat += meatGained;
                        this.showEvent(`the traps yielded ${meatGained} meat and ${furGained} fur`);
                    } else {
                        this.showEvent(`the traps yielded ${furGained} fur`);
                    }
                }

                // Check for stranger arrival
                if (!this.state.strangerArrived && this.state.temperature >= 50) {
                    this.strangerArrives();
                }

                this.updateUI();
                this.saveGame();
            },

            updateCooldowns() {
                if (this.state.actionCooldowns.wood > 0) {
                    this.state.actionCooldowns.wood -= 100;
                    const button = document.getElementById('gather-wood');
                    if (this.state.actionCooldowns.wood <= 0) {
                        button.disabled = false;
                        button.textContent = 'gather wood';
                    } else {
                        const seconds = Math.ceil(this.state.actionCooldowns.wood / 1000);
                        button.textContent = `gather wood (${seconds}s)`;
                    }
                }
            },

            stokeTheFire() {
                if (!this.state.fireStoked) {
                    this.state.fireStoked = true;
                    this.state.temperature = 30;
                    this.showEvent("the fire is roaring");
                    document.getElementById('stoke-fire').textContent = 'stoke fire';
                    this.unlockSection('actions-section');
                    this.unlockSection('resources-section');
                } else {
                    if (this.state.wood >= 1) {
                        this.state.wood -= 1;
                        this.state.temperature = Math.min(100, this.state.temperature + 10);
                        this.showEvent("the fire is roaring");
                    } else {
                        this.showEvent("not enough wood");
                    }
                }
                this.updateUI();
            },

            gatherWood() {
                const button = document.getElementById('gather-wood');
                if (this.state.actionCooldowns.wood <= 0) {
                    const amount = 1 + (this.state.buildings.cart * 2);
                    this.state.wood += amount;
                    this.state.actionCooldowns.wood = 2000; // 2 seconds
                    button.disabled = true;

                    const messages = [
                        "the wood is dry and good for burning",
                        "the wood is wet",
                        "the wood is scarce",
                        "sticks and branches are abundant"
                    ];
                    this.showEvent(messages[Math.floor(Math.random() * messages.length)]);

                    this.updateUI();
                }
            },

            strangerArrives() {
                this.state.strangerArrived = true;
                this.showEvent("a ragged stranger stumbles through the doorway");
                setTimeout(() => {
                    this.showEvent("the stranger shivers, and says nothing");
                    this.unlockSection('buildings-section');
                }, 3000);
            },

            buildStructure(type) {
                const costs = {
                    trap: { wood: 10 },
                    cart: { wood: 30 },
                    hut: { wood: 100, fur: 10 }
                };

                const cost = costs[type];
                let canBuild = true;

                for (let resource in cost) {
                    if (this.state[resource] < cost[resource]) {
                        canBuild = false;
                        break;
                    }
                }

                if (canBuild) {
                    for (let resource in cost) {
                        this.state[resource] -= cost[resource];
                    }
                    this.state.buildings[type]++;

                    const messages = {
                        trap: "a trap is built",
                        cart: "a cart is built",
                        hut: "a hut is built"
                    };
                    this.showEvent(messages[type]);
                    this.updateUI();
                } else {
                    this.showEvent("not enough resources");
                }
            },

            showEvent(message) {
                const eventsEl = document.getElementById('events');
                eventsEl.textContent = message;
            },

            unlockSection(sectionId) {
                document.getElementById(sectionId).classList.remove('hidden');
            },

            updateUI() {
                // Update story based on temperature
                const storyEl = document.getElementById('story');
                if (this.state.temperature === 0) {
                    storyEl.textContent = "the room is cold";
                } else if (this.state.temperature < 30) {
                    storyEl.textContent = "the fire is dying";
                } else if (this.state.temperature < 60) {
                    storyEl.textContent = "the fire is warm";
                } else {
                    storyEl.textContent = "the fire is roaring";
                }

                // Update temperature bar
                const tempEl = document.getElementById('temperature');
                const bars = Math.floor(this.state.temperature / 5);
                tempEl.textContent = '█'.repeat(bars) + '░'.repeat(20 - bars);

                // Update resources
                const resourcesEl = document.getElementById('resources');
                resourcesEl.innerHTML = `
                    <div class="resource">wood <span class="resource-value">${this.state.wood}</span></div>
                    ${this.state.fur > 0 || this.state.buildings.trap > 0 ? `<div class="resource">fur <span class="resource-value">${this.state.fur}</span></div>` : ''}
                    ${this.state.meat > 0 || this.state.buildings.trap > 0 ? `<div class="resource">meat <span class="resource-value">${this.state.meat}</span></div>` : ''}
                `;

                // Update buildings
                if (this.state.strangerArrived) {
                    const buildingsEl = document.getElementById('buildings');
                    buildingsEl.innerHTML = `
                        <div class="building">
                            <span class="building-name">trap</span>
                            <span class="building-count">${this.state.buildings.trap}</span>
                            <div class="building-controls">
                                <button onclick="game.buildStructure('trap')">build <span class="cost">[10 wood]</span></button>
                            </div>
                        </div>
                        <div class="building">
                            <span class="building-name">cart</span>
                            <span class="building-count">${this.state.buildings.cart}</span>
                            <div class="building-controls">
                                <button onclick="game.buildStructure('cart')">build <span class="cost">[30 wood]</span></button>
                            </div>
                        </div>
                        <div class="building">
                            <span class="building-name">hut</span>
                            <span class="building-count">${this.state.buildings.hut}</span>
                            <div class="building-controls">
                                <button onclick="game.buildStructure('hut')">build <span class="cost">[100 wood, 10 fur]</span></button>
                            </div>
                        </div>
                    `;
                }
            },

            saveGame() {
                localStorage.setItem('coldRoomSave', JSON.stringify(this.state));
            },

            loadGame() {
                const saved = localStorage.getItem('coldRoomSave');
                if (saved) {
                    this.state = JSON.parse(saved);

                    // Unlock sections based on loaded state
                    if (this.state.fireStoked) {
                        this.unlockSection('actions-section');
                        this.unlockSection('resources-section');
                        document.getElementById('stoke-fire').textContent = 'stoke fire';
                    }
                    if (this.state.strangerArrived) {
                        this.unlockSection('buildings-section');
                    }
                }
            },

            resetGame() {
                if (confirm('Are you sure you want to restart? All progress will be lost.')) {
                    localStorage.removeItem('coldRoomSave');
                    location.reload();
                }
            }
        };

        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', () => {
            game.init();
        });
    </script>
</body>
</html>
